<html>
    <head>
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
        
        <link rel="stylesheet" type="text/css" href="css/index.css">

        <link rel="stylesheet" href="./lib/onsenui/css/onsenui.css">
        <link rel="stylesheet" href="./lib/onsenui/css/onsen-css-components.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" />
        <script src="./lib/onsenui/js/onsenui.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> 

        <link rel="stylesheet" type="text/css" href="css/common.css">        
    </head>
    <body>

        <ons-navigator swipeable id="myNavigator" page="signup.html"></ons-navigator>

        <!-- Sign Up Process -->
        <template id="signup.html">
            <ons-page id="signup-temp">
                <br /><br />  
                <ons-toolbar>  
                    <div class="center">Log In</div>  
                </ons-toolbar>  
                <!-- Information fields -->
                <div style="text-align: center; margin-top: 30px;">  
                    <p>  
                        <ons-input id="username" modifier="underbar" placeholder="Username" float></ons-input>  
                    </p>  
                    <p>  
                        <ons-input id="password" modifier="underbar" type="password" placeholder="Password" float></ons-input>  
                    </p>
                    <!-- <p>  
                        <ons-input id="passwordConfirm" modifier="underbar" type="password" placeholder="Confirm Password" float></ons-input>  
                    </p>   -->
                    <p style="margin-top: 30px;">  
                        <ons-button onclick="logIn()">Log In</ons-button>  
                    </p>
                    
                    <p style="margin-top: 30px;">
                        <span onclick="createAccount_1()">Create an account</span>
                    </p>
                </div>  
          </ons-page>
        </template>

        

        <!-- create account page 1 -->
        <template id="createAccount_1.html">
            <ons-page id="createAccount-temp">
                <br /><br />
                <ons-toolbar>
                    <div class="center">Sign up</div>
                </ons-toolbar>

                <!-- input fields -->
                <div class="center">
                    <ons-card>
                        <!-- first row - name -->
                        <ons-row>
                            <ons-col width="100%">
                                <ons-input placeholder="name"></ons-input>
                            </ons-col>  
                        </ons-row>
                        <!-- second row - age & gender -->
                        <ons-row>
                            <ons-col>
                                <ons-input placeholder="age"></ons-input>
                            </ons-col>
                            <ons-col>
                                <ons-input placeholder="gender"></ons-input>
                            </ons-col>
                        </ons-row>
                        <!-- third row - location input -->
                        <ons-row>
                            <ons-col width="100%">
                                <ons-input placeholder="location"></ons-input>
                            </ons-col>  
                        </ons-row>
                        <!-- fourth row - student/working radio -->
                        <ons-row>
                            <ons-col>
                                <label class="radio-button">
                                    <ons-radio class="radio-button__input radio-button--material__input">Student</ons-radio>
                                </label>
                            </ons-col>
                            <ons-col>
                                <ons-radio>Working</ons-radio>
                            </ons-col>
                        </ons-row>
                        <!-- fifth row - next button -->
                        <ons-row>
                            <ons-col>
                                <ons-button class="button--large--cta" onclick="createAccount_2()">Next</ons-button>
                            </ons-col>
                        </ons-row>
                    </ons-card>
                </div>
            </ons-page>
        </template>
        <!-- End of create account page 1 -->

        <!-- create account page 2 -->
        <template id="createAccount_2.html">
            <ons-page id="createAccount-temp">
                <br /><br />
                <ons-toolbar>
                    <div class="center">Sign up</div>
                </ons-toolbar>

                <!-- input fields -->
                <div class="center">
                    <ons-card>
                        <!-- first row - name -->
                        <ons-row>
                            <ons-col width="100%">
                                <ons-input placeholder="Job Title"></ons-input>
                            </ons-col>  
                        </ons-row>
                        <!-- second row - age & gender -->
                        <ons-row>
                            <ons-col width="100%">
                                <ons-input placeholder="Years of experience"></ons-input>
                            </ons-col>
                        </ons-row>
                        <!-- third row - location input -->
                        <ons-row>
                            <ons-col width="100%">
                                <ons-input placeholder="Firm type"></ons-input>
                            </ons-col>  
                        </ons-row>
                        <!-- fourth row - student/working radio -->
                        <ons-row>
                            <ons-col width="100%">
                                <ons-input placeholder="Salary"></ons-input>
                            </ons-col>
                        </ons-row>
                        <!-- fifth row - next button -->
                        <ons-row>
                            <ons-col>
                                <ons-button class="button--large--cta" onclick="createAccount_done()">Done</ons-button>
                            </ons-col>
                        </ons-row>
                    </ons-card>
                </div>
            </ons-page>
        </template>
        <!-- End of create account page 2 -->


        <!-- Home Page -->
        <template id="home.html">
            <ons-page id="home-temp">
                <ons-toolbar>
                    <div class="center">Home</div>
                    <div class="right"><ons-button onclick="logOut()" style="padding-top: 10px;padding-right: 10px;">Log Out</ons-button></div>
                </ons-toolbar>
                
                
                <!-- search boxes -->
                <div style="padding:30px;">
                    <!-- city dropdown -->
                    <div class="form-group" style="padding:10px;">
                        <label for="city">Select the city</label>
                        <div>
                            <ons-select select-id="city" class="form-field-full" modifier="underbar">
                                <option value="">Select a city</option>
                                <option value="vancouver" selected>Vancouver</option>
                                <option value="toronto">Toronto</option>
                            </ons-select>
                        </div>
                    </div>

                    <!-- Experience dropdown -->
                    <div class="form-group" style="padding:10px;"> 
                        <label for="experience">Years of experience</label>
                        <div>
                            <ons-select select-id="experience" class="form-field-full" modifier="underbar">
                                <option value="">Select a value</option>
                                <option value="1" selected>0 - 1 year</option>
                                <option value="2">1 - 3 years</option>
                                <option value="3">4 - 6 years</option>
                                <option value="4">7 - 9 years</option>
                                <option value="5">10 - 12 years</option>
                                <option value="6">13 - 15 years</option>
                                <option value="7">16+ years</option>
                            </ons-select>
                        </div>
                    </div>

                    <!-- Salary dropdown -->
                    <div class="form-group" style="padding:10px;"> 
                        <label for="salary">Annual Salary</label>
                        <div>
                            <ons-select select-id="salary" class="form-field-full" modifier="underbar">
                                <option value="0">Select a value</option>
                                <option value="1">under $29,999</option>
                                <option value="2">$30,000 - $49,999</option>
                                <option value="3" selected>$50,000 - $79,999</option>
                                <option value="4">$80,000 - $129,999</option>
                                <option value="5">$130,000 - $179,999</option>
                                <option value="6">$180,000 +</option>
                            </ons-select>
                        </div>
                    </div>

                    <!-- Seniority dropdown -->
                    <div class="form-group" style="padding:10px;"> 
                        <label for="seniority">Seniority</label>
                        <div>
                            <ons-select select-id="seniority" class="form-field-full" modifier="underbar">
                                <option value="">Select a seniority</option>
                                <option value="Junior" selected>Junior</option>
                                <option value="Intermediate">Intermediate</option>
                                <option value="Senior">Senior</option>
                                <option value="Team Lead">Team Lead</option>
                                <option value="Manager">Manager</option>
                                <option value="Director">Director</option>
                                <option value="Vice President">Vice President</option>
                            </ons-select>
                        </div>
                    </div>

                    <ons-button id="submitBtn" onclick="submitSearch()">
                        Search
                    </ons-button>

                </div>
                
                <!-- Display wine list dynamically -->
                <ons-list-header>Job List</ons-list-header>
                <ons-list>
                    <ons-lazy-repeat id="dynamic-list"></ons-lazy-repeat>
                    <!-- <ons-list-item>
                    <div class="center">
                        <span id="salary" class="list-item__title">CAD$ 50,000</span>
                        <span id="city" class="list-item__subtitle">Toronto 1-3years Junior</span>
                    </div>
                    <div class="right"><ons-button icon="md-caret-right"></ons-button></div>
                    </ons-list-item> -->
                </ons-list>                      
            </ons-page>
        </template>

        

        <!-- Single Product Page -->
        <template id="single.html">
            <ons-page id="single-temp">
                <ons-toolbar>
                    <!-- Button to pop page back to home -->
                    <div class="left"><ons-back-button>Back</ons-back-button></div>
                    <div class="center" id="center-toolbar"></div>
                </ons-toolbar>

                <!-- Display job information -->
                <ons-card>
                    <div class="title" id="singleTitle"></div>
                    <div class="title" id="singleSalary"></div>
                    <div class="title" id="singleCity"></div>
                    <div class="title" id="singleExperience"></div>
                    <div class="title" id="singleSeniority"></div>
                    <div class="title" id="singleFirmType"></div>
                </ons-card>
                <ons-card>
                    <div class="title">2 person meal : <span id="meal"></span></div>
                    <div class="title">Gas Price : <span id="gas"></span></div>
                    <div class="title">Internet per month : <span id="internet"></span></div>
                    <div class="title">1 bedroom apartment in city center : <span id="rent"></span></div>
                </ons-card>
            </ons-page>
        </template>

        
        <ons-modal id="spinner-modal">
            <div style="margin: auto;">
                <ons-icon icon="md-spinner" size="100px" spin></ons-icon>              
            </div>
        </ons-modal>

    
    </body>

    <script src="./js/index.js"></script>
    <script src="./js/living-standard.js"></script>

    <script>
        var logIn = function() {
            myNavigator.resetToPage('home.html')
        };

        var logOut = function() {
            myNavigator.resetToPage('signup.html')
        };

        var createAccount_1 = function(){
            myNavigator.pushPage('createAccount_1.html')
        };

        var createAccount_2 = function(){
            myNavigator.pushPage('createAccount_2.html')
        };

        var createAccount_done = function (){
            myNavigator.resetToPage('home.html')
        };


        // Sign up function
        var signup = function() {  
            var user = document.getElementById('username').value;  
            var pw = document.getElementById('password').value;  
            var pwConfirm = document.getElementById('passwordConfirm').value;

            // If passwords don't match
            if (pw !== pwConfirm) {  
                ons.notification.alert('Please make sure both passwords match');  
            // If both password fields are empty
            } else if (pw == 0 || pwConfirm == 0) {  
                ons.notification.alert('Please enter a password'); 

            // If user field is empty
            } else if (user == 0) {  
                ons.notification.alert('Please enter a username'); 

            // If passwords match 
            }  else {
                ons.notification.alert('Congratulations! You have successfully signed up.');  
                
                // Redirect to home page
                myNavigator.resetToPage('home.html')
            }
        };  

        // any even managers or other funcationality that should wait intil the page init has completed
            document.addEventListener('init', function(event) {            
                var page = event.target;           

                //  load list of wines on home page
                 if(page.id === 'home-temp'){

                    // loadWineList(page);
                } 

                // load selected wine page
                if(page.id === 'single-temp'){
                    populateSingle(page, page.data.job);
                    
                }             
            }); 

        function populateSingle(page, job){
            console.log(job);
            var currJobCity = job.city;
            var currCity = cityCosts.find(({city})=> city === currJobCity);
            console.log(currCity);
            page.querySelector('ons-toolbar .center').innerHTML = job.jobtitle;

            page.querySelector('#singleTitle').innerHTML = job.jobtitle;
            page.querySelector('#singleSalary').innerHTML = job.salary;
            page.querySelector('#singleCity').innerHTML = job.city;
            page.querySelector('#singleSeniority').innerHTML = job.seniority;
            page.querySelector('#singleFirmType').innerHTML = job.firmtype;

            page.querySelector('#meal').innerHTML = currCity.food;
            page.querySelector('#gas').innerHTML = currCity.gas;
            page.querySelector('#internet').innerHTML = currCity.internet;
            page.querySelector('#rent').innerHTML = currCity.rent;
        }
    

        function submitSearch(){
            var page = document.getElementById('home-temp');
            var min_salary_input;
            var max_salary_input;
            var salaryCase = page.querySelector('#salary').value;

            
            switch(salaryCase){
                case '0':
                    break;
                case '1':
                    min_salary_input = 0;
                    max_salary_input = 29999;
                    break;
                case '2':
                    min_salary_input = 30000;
                    max_salary_input = 49999;
                    break;
                case '3':
                    min_salary_input = 50000;
                    max_salary_input = 79999;
                    break;
                case '4':
                    min_salary_input = 80000;
                    max_salary_input = 129999;
                    break;
                case '5': 
                    min_salary_input = 130000;
                    max_salary_input = 179999;
                    break;
                case '6':
                    min_salary = 180000;
                    break;
            }
            console.log('T1:'+ salaryCase);
            console.log('T2:'+ min_salary_input);
            console.log('T3:'+ max_salary_input);

            var searchParam = {
                city: page.querySelector('#city').value,
                experience: page.querySelector('#experience').value,
                seniority: page.querySelector('#seniority').value,
                min_salary: min_salary_input,
                max_salary: max_salary_input
            }


            loadJobsList(searchParam);
        }

        function loadJobsList(result){
            var spinnerModal = document.querySelector('#spinner-modal');
            spinnerModal.show();
            $.ajax('https://MDIA4295.verdipang.ca/dataset/read.php?city=' + result.city +'&experience='+ result.experience + '&seniority=' + result.seniority + '&min_salary=' + result.min_salary + '&max_salary=' + result.max_salary)
                .done(function(result){
                    // console.log(result);
                    populateJobsList(result);
                })
                .fail(function(xhr,status,error){
                    console.log('error:' + xhr.status);
                })
                .always(function(){
                    spinnerModal.hide();
                })
        }

        function populateJobsList(result) {
            // select the list element
            var page = document.getElementById('home-temp');
            var dynList = page.querySelector('#dynamic-list');

            dynList.querySelectorAll('ons-list-item').forEach(n => n.remove());

            for(let i = 0; i < result.count; i++) {

                dynList.appendChild(
                    ons.createElement(
                        
                        '<ons-list-item>' +
                            '<div class="center">' +
                                '<span id="salary" class="list-item__title">CAD $ ' + result.jobs[i].salary + '</span>' +
                                '<span id="city" class="list-item__subtitle">'+ result.jobs[i].city +' | ' + result.jobs[i].experience + ' | ' + result.jobs[i].seniority + '</span>' +
                            '</div>' +
                            '<div class="right"><ons-button onclick="pushSingleView(\'' + result.jobs[i].id + '\')" icon="md-caret-right"></ons-button></div>' + 
                        '</ons-list-item>'
                        
                    )
                );
            }
        }

        // push single page onto stack
        function pushSingleView(id){

            $.ajax('https://MDIA4295.verdipang.ca/dataset/read.php?id=' + id)
                .done(function(result){
                    createSignleView(result);
                })
                .fail(function(xhr,status,error){
                    console.log('error:' + xhr.status);
                })
            // get the current wine from the wineList data 
            // var currWine = wineList[Number.parseInt(fIndex)];

            // push the single page view on the stack 
            // document.querySelector('#myNavigator').pushPage('single.html', {data: {cWine: currWine}});
        }

        function createSignleView(result){
            var currJob = result.jobs[0];
            
            // console.log(currCity);

            // var selectedCity = cityCosts[city[currCity]]
            // console.log(currCity);
            
            // var page = document.getElementById('single-temp');
            // page.querySelector('#singleTitle').innerHTML = result.jobs[0].jobtitle;
            document.querySelector('#myNavigator').pushPage('single.html', {data: {job: currJob}})
        }
    </script>
</html>
